<view class="container">
    <!-- User Profile Section -->
    <view class="profile-section">
        <view class="avatar-container">
            <image class="avatar" src="{{currentUser.avatarUrl || '/images/default-avatar.png'}}" mode="aspectFill"></image>
        </view>
        <view class="user-info">
            <text class="nickname">{{currentUser.nickname || 'User'}}</text>
            <image class="gender-icon" wx:if="{{currentUser.gender === 'male'}}" src="/assets/icons/male_24dp_0000F5.png" mode="aspectFit"></image>
            <image class="gender-icon" wx:if="{{currentUser.gender === 'female'}}" src="/assets/icons/female_24dp_EA33F7.png" mode="aspectFit"></image>
        </view>
    </view>

    <!-- Statistics Section -->
    <view class="stats-section">
        <view class="stats-header" bindtap="toggleStats">
            <text class="stats-title">个人表现</text>
            <text class="stats-toggle-icon">{{showStats ? '▲' : '▼'}}</text>
        </view>
        <view wx:if="{{showStats}}" class="stats-main">
            <view class="elo-row">
                <text class="stats-elo-value">{{userStats.ELO || '--'}}</text>
            </view>
            <view class="stats-cards">
                <view class="stats-card main-stats-card">
                    <view class="stats-card-title">总计</view>
                    <view class="stats-card-row">
                        <view class="stats-card-item"><text class="stats-label">场次</text><text class="stats-value">{{userStats.Games || 0}}</text></view>
                        <view class="stats-card-item"><text class="stats-label">胜</text><text class="stats-value">{{userStats.Wins || 0}}</text></view>
                        <view class="stats-card-item"><text class="stats-label">负</text><text class="stats-value">{{userStats.Losses || 0}}</text></view>
                        <view class="stats-card-item"><text class="stats-label">胜率</text><text class="stats-value">{{userStats.winRateDisplay || '0.0'}}%</text></view>
                    </view>
                </view>
                <view class="stats-card same-gender-card">
                    <view class="stats-card-title">{{sameGenderTitle}}</view>
                    <view class="stats-card-row">
                        <view class="stats-card-item"><text class="stats-label">场次</text><text class="stats-value">{{userStats.SameGenderGames || 0}}</text></view>
                        <view class="stats-card-item"><text class="stats-label">胜</text><text class="stats-value">{{userStats.SameGenderWins || 0}}</text></view>
                        <view class="stats-card-item"><text class="stats-label">负</text><text class="stats-value">{{userStats.SameGenderLosses || 0}}</text></view>
                        <view class="stats-card-item"><text class="stats-label">胜率</text><text class="stats-value">{{userStats.sameGenderWinRateDisplay || '0.0'}}%</text></view>
                    </view>
                </view>
                <view class="stats-card mixed-card">
                    <view class="stats-card-title">混双</view>
                    <view class="stats-card-row">
                        <view class="stats-card-item"><text class="stats-label">场次</text><text class="stats-value">{{userStats.MixedGames || 0}}</text></view>
                        <view class="stats-card-item"><text class="stats-label">胜</text><text class="stats-value">{{userStats.MixedWins || 0}}</text></view>
                        <view class="stats-card-item"><text class="stats-label">负</text><text class="stats-value">{{userStats.MixedLosses || 0}}</text></view>
                        <view class="stats-card-item"><text class="stats-label">胜率</text><text class="stats-value">{{userStats.mixedWinRateDisplay || '0.0'}}%</text></view>
                    </view>
                </view>
            </view>
        </view>
    </view>

    <!-- Title Section -->
    <view class="title-section" bindtap="toggleMatches" style="display: flex; align-items: center; justify-content: space-between;">
        <text class="title">比赛</text>
        <text class="stats-toggle-icon">{{showMatches ? '▲' : '▼'}}</text>
    </view>

    <!-- Tab Navigation -->
    <view wx:if="{{showMatches}}" class="tab-navigation">
        <view class="tab-item {{activeTab === 'upcoming' ? 'active' : ''}}" 
              bindtap="switchTab" data-tab="upcoming">
            <text>待进行</text>
        </view>
        <view class="tab-item {{activeTab === 'history' ? 'active' : ''}}" 
              bindtap="switchTab" data-tab="history">
            <text>历史</text>
        </view>
    </view>

    <!-- Content Section -->
    <view wx:if="{{showMatches}}" class="content-section">
        <view wx:if="{{isLoading}}" class="loading-container">
            <text>Loading...</text>
        </view>
        
        <view wx:elif="{{isEmpty}}" class="empty-container">
            <text wx:if="{{activeTab === 'upcoming'}}">No upcoming matches</text>
            <text wx:else>No completed matches</text>
        </view>
        
        <block wx:else>
            <!-- Upcoming Matches -->
            <view wx:if="{{activeTab === 'upcoming'}}" class="match-list">
                <view wx:for="{{upcomingMatches}}" wx:key="MatchId" class="match-card">
                    <view class="match-header">
                        <text class="match-time">{{item.formattedStartTime}}</text>
                        <view class="match-status">Upcoming</view>
                    </view>
                    <view class="teams-container">
                        <view class="team">
                            <text class="player-name">{{item.PlayerNameA1.name}}</text>
                            <text wx:if="{{item.PlayerNameA2}}" class="player-name">{{item.PlayerNameA2.name}}</text>
                        </view>
                        <view class="score">
                            <text>{{item.ScoreA || 0}} - {{item.ScoreB || 0}}</text>
                        </view>
                        <view class="team">
                            <text class="player-name">{{item.PlayerNameB1.name}}</text>
                            <text wx:if="{{item.PlayerNameB2}}" class="player-name">{{item.PlayerNameB2.name}}</text>
                        </view>
                    </view>
                    <view class="match-footer">
                        <text>Referee: {{item.RefereeName}}</text>
                        <button class="edit-btn" bindtap="editScore" data-matchid="{{item.MatchId}}">Complete Match</button>
                    </view>
                </view>
            </view>

            <!-- Completed Matches -->
            <view wx:if="{{activeTab === 'history'}}" class="match-list">
                <view wx:for="{{completedMatches}}" wx:key="MatchId" class="match-card">
                    <view class="match-header">
                        <text class="match-time">{{item.formattedCompleteTime}}</text>
                        <view class="result-badge {{item.result}}">{{item.result}}</view>
                    </view>
                    <view class="teams-container">
                        <view class="team">
                            <text class="player-name">{{item.PlayerNameA1.name}}</text>
                            <text wx:if="{{item.PlayerNameA2}}" class="player-name">{{item.PlayerNameA2.name}}</text>
                        </view>
                        <view class="score">
                            <text>{{item.ScoreA}} - {{item.ScoreB}}</text>
                        </view>
                        <view class="team">
                            <text class="player-name">{{item.PlayerNameB1.name}}</text>
                            <text wx:if="{{item.PlayerNameB2}}" class="player-name">{{item.PlayerNameB2.name}}</text>
                        </view>
                    </view>
                    <view class="match-footer">
                        <text>Referee: {{item.RefereeName}}</text>
                    </view>
                </view>
            </view>
        </block>
    </view>
</view>

<!-- Custom Score Input Modal -->
<view wx:if="{{showScoreInput}}" class="score-input-modal">
    <view class="score-input-overlay" bindtap="cancelScore"></view>
    <view class="score-input-container">
        <view class="score-input-header">
            <text class="score-input-title">Complete Match</text>
        </view>
        <view class="score-input-content">
            <view class="score-input-row">
                <input class="score-input-box" 
                       placeholder="Team A" 
                       value="{{teamAScore}}"
                       bindinput="onTeamAScoreInput"
                       type="number"
                       maxlength="3" />
                <text class="score-input-separator">:</text>
                <input class="score-input-box" 
                       placeholder="Team B" 
                       value="{{teamBScore}}"
                       bindinput="onTeamBScoreInput"
                       type="number"
                       maxlength="3" />
            </view>
        </view>
        <view class="score-input-actions">
            <button class="score-input-btn cancel-btn" bindtap="cancelScore">Cancel</button>
            <button class="score-input-btn confirm-btn" bindtap="confirmScore">Confirm</button>
        </view>
    </view>
</view> 