<view class="container">
  <view class="card">
    <view class="card-title">New Doubles Game</view>
    
    <view class="user-greeting" wx:if="{{username}}">
      <text>Hello, {{username}}!</text>
    </view>
    
    <!-- Show this when no players exist -->
    <view wx:if="{{players.length === 0}}" class="warning-box">
      <text class="warning-text">You need to add players before creating a game.</text>
      <button bindtap="navigateToAddPlayer" type="primary">Add Players</button>
    </view>
    
    <!-- Show this when some players exist but not enough -->
    <view wx:elif="{{players.length < 4}}" class="warning-box">
      <text class="warning-text">You need at least 4 players to record a doubles game.</text>
      <text class="warning-subtext">Currently you have {{players.length}} player(s).</text>
      <button bindtap="navigateToAddPlayer" type="primary">Add More Players</button>
    </view>
    
    <!-- Show game form when there are enough players -->
    <view wx:else class="game-form">
      <view class="team-section">
        <view class="team-header">
          <text class="team-title">Team A</text>
        </view>
        
        <view class="form-group">
          <text class="label">Player 1:</text>
          <player-selector 
            players="{{players}}" 
            selectedPlayerId="{{players[teamAPlayer1Index].id}}"
            placeholder="Select player"
            bind:select="onTeamAPlayer1Select"
          />
        </view>
        
        <view class="form-group">
          <text class="label">Player 2:</text>
          <player-selector 
            players="{{players}}" 
            selectedPlayerId="{{players[teamAPlayer2Index].id}}"
            placeholder="Select player"
            bind:select="onTeamAPlayer2Select"
          />
        </view>
        
        <view class="form-group">
          <text class="label">Score:</text>
          <input 
            type="number" 
            class="input score-input" 
            value="{{teamAScore}}" 
            bindinput="updateTeamAScore" 
            disabled="{{isLoading}}"
          />
        </view>
      </view>
      
      <view class="team-section">
        <view class="team-header">
          <text class="team-title">Team B</text>
        </view>
        
        <view class="form-group">
          <text class="label">Player 1:</text>
          <player-selector 
            players="{{players}}" 
            selectedPlayerId="{{players[teamBPlayer1Index].id}}"
            placeholder="Select player"
            bind:select="onTeamBPlayer1Select"
          />
        </view>
        
        <view class="form-group">
          <text class="label">Player 2:</text>
          <player-selector 
            players="{{players}}" 
            selectedPlayerId="{{players[teamBPlayer2Index].id}}"
            placeholder="Select player"
            bind:select="onTeamBPlayer2Select"
          />
        </view>
        
        <view class="form-group">
          <text class="label">Score:</text>
          <input 
            type="number" 
            class="input score-input" 
            value="{{teamBScore}}" 
            bindinput="updateTeamBScore" 
            disabled="{{isLoading}}"
          />
        </view>
      </view>
      
      <view class="actions">
        <button 
          bindtap="submitGame" 
          class="submit-btn" 
          type="primary" 
          loading="{{isLoading}}" 
          disabled="{{isLoading}}"
        >
          Save Game
        </button>
      </view>
    </view>
  </view>
</view>