<view class="container">
  <!-- Always display the title at the top, regardless of loading state -->
  <view class="game-title">{{gameName || (isFromGame ? '对阵表' : '我的比赛')}}</view>
  
  <!-- Loading indicator below the title -->
  <view wx:if="{{isLoading}}" class="loading-container">
    <view class="loading-indicator">加载中...</view>
  </view>
  
  <!-- View for game-specific matches organized by rounds -->
  <block wx:elif="{{isFromGame}}">
    <view wx:if="{{matchRounds.length === 0}}" class="empty">该游戏没有生成对阵表</view>
    
    <view wx:else class="rounds-container">
      <view wx:for="{{matchRounds}}" wx:key="round" class="round-section">
        <view class="round-header">第 {{item.round}} 轮</view>
        
        <view class="courts-container">
          <view wx:for="{{item.courts}}" wx:for-item="court" wx:key="id" class="court-card">
            <view class="court-header">场地 {{court.court}}</view>
            <view class="match-teams">
              <!-- Team A -->
              <view class="team team-a">
                <view wx:for="{{court.teams[0]}}" wx:for-item="player" wx:key="*this" class="player">
                  <text>{{player.name || player}}</text>
                </view>
              </view>
              
              <view class="vs-indicator">VS</view>
              
              <!-- Team B -->
              <view class="team team-b">
                <view wx:for="{{court.teams[1]}}" wx:for-item="player" wx:key="*this" class="player">
                  <text>{{player.name || player}}</text>
                </view>
              </view>
            </view>
          </view>
        </view>
      </view>
      
      <view class="actions">
        <button class="back-btn" bindtap="navigateBack">返回</button>
        <button class="regenerate-btn" bindtap="navigateToGenerate" wx:if="{{isOwner}}">重新生成</button>
      </view>
    </view>
  </block>
  
  <!-- Original view for attention matches -->
  <block wx:else>
    <view wx:if="{{attentionMatches.length === 0}}" class="empty">没有需要您关注的比赛</view>
    <view wx:else>
      <view wx:for="{{attentionMatches}}" wx:key="_id" class="match-card">
        <view class="match-header">
          <text class="players">{{item.PlayerNameA1}}, {{item.PlayerNameA2}} <text class="vs">vs</text> {{item.PlayerNameB1}}, {{item.PlayerNameB2}}</text>
        </view>
        <view class="score-row">
          <text class="score-label">比分:</text>
          <text class="score-value">{{item.ScoreA}} : {{item.ScoreB}}</text>
        </view>
        <view class="meta-row">
          <text class="court">场地: {{item.Court}}</text>
        </view>
        <view class="time-row">
          <text class="start-time">开始时间: {{item.formattedStartTime}}</text>
        </view>
        <view class="edit-row">
          <button class="edit-btn" size="mini" bindtap="onEditTap" data-id="{{item._id}}">编辑</button>
        </view>
        <view wx:if="{{editMatchId === item._id}}" class="edit-form">
          <view class="edit-inputs">
            <input class="score-input" type="number" placeholder="队伍A" value="{{editScoreA}}" bindinput="onEditScoreAInput" />
            <text class="edit-vs">:</text>
            <input class="score-input" type="number" placeholder="队伍B" value="{{editScoreB}}" bindinput="onEditScoreBInput" />
          </view>
          <view style="display: flex; justify-content: flex-end;">
            <button class="save-btn" size="mini" type="primary" loading="{{isSaving}}" bindtap="onSaveScore">保存</button>
            <button class="cancel-btn" size="mini" bindtap="onCancelEdit">取消</button>
          </view>
        </view>
      </view>
    </view>
  </block>
</view>