<view class="container">
  <view class="login-card">
    <view class="app-title">Badminton Score System</view>
    
    <!-- Login Step -->
    <view wx:if="{{!showRegistration}}">
      <view class="welcome-text">Welcome! Please login with WeChat to continue.</view>
      
      <view class="login-section">
        <button 
          bindtap="handleWeChatLogin" 
          class="wechat-login-btn" 
          type="primary"
          loading="{{isLoading}}"
        >
          <text class="wechat-icon">ğŸ“±</text>
          Login with WeChat
        </button>
      </view>
      
      <view class="note">
        <text>We'll use your WeChat profile to personalize your badminton experience.</text>
      </view>
    </view>
    
    <!-- Registration Step -->
    <view wx:else class="registration">
      <view class="welcome-text">Welcome to Badminton Score System!</view>
      <view class="subtitle">Please complete your registration to continue.</view>
      
      <!-- Avatar Section -->
      <view class="avatar-section">
        <view class="avatar-container">
          <image 
            class="avatar" 
            src="{{avatarUrl || 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiBmaWxsPSIjRjBGMEYwIi8+CjxjaXJjbGUgY3g9IjUwIiBjeT0iMzUiIHI9IjE1IiBmaWxsPSIjQ0NDIi8+CjxwYXRoIGQ9Ik0yMCA3NUMyMCA2NS4wNTc2IDI4LjA1NzYgNTcgMzggNTdINjJDNzEuOTQyNCA1NyA4MCA2NS4wNTc2IDgwIDc1VjgwSDIwVjc1WiIgZmlsbD0iI0NDQyIvPgo8L3N2Zz4K'}}" 
            mode="aspectFill"
            binderror="onAvatarError"
            bindload="onAvatarLoad"
          ></image>
          <view class="avatar-edit-btn" bindtap="toggleAvatarEdit">
            <text class="edit-icon">âœï¸</text>
          </view>
        </view>
        <text class="avatar-label">ç‚¹å‡»ç¼–è¾‘å¤´åƒ</text>
      </view>
      
      <!-- Avatar Selection Modal -->
      <view wx:if="{{isEditingAvatar}}" class="avatar-modal">
        <view class="avatar-modal-overlay" bindtap="toggleAvatarEdit"></view>
        <view class="avatar-modal-content">
          <view class="avatar-modal-header">
            <text class="avatar-modal-title">é€‰æ‹©å¤´åƒ</text>
          </view>
          <view class="avatar-options">
            <view class="avatar-option" bindtap="chooseAvatar">
              <view class="option-avatar-placeholder">
                <text class="placeholder-icon">ğŸ“·</text>
              </view>
              <text class="option-text">ä»ç›¸å†Œé€‰æ‹©</text>
            </view>
          </view>
          <view class="avatar-modal-actions">
            <button class="cancel-btn" bindtap="toggleAvatarEdit">å–æ¶ˆ</button>
          </view>
        </view>
      </view>
      
      <!-- Nickname Input Section -->
      <view class="nickname-section">
        <text class="nickname-label">æ˜µç§°</text>
        <input 
          class="nickname-input" 
          value="{{nickname}}" 
          bindinput="onNicknameInput"
          placeholder="è¯·è¾“å…¥æ‚¨çš„æ˜µç§°"
          maxlength="20"
          focus="true"
        />
        
        <!-- Availability indicator -->
        <view wx:if="{{nickname}}" class="availability-indicator">
          <view wx:if="{{checkingAvailability}}" class="checking">
            <text class="checking-text">æ£€æŸ¥ä¸­...</text>
          </view>
          <view wx:elif="{{nicknameAvailable === true}}" class="available">
            <text class="available-text">âœ“ å¯ç”¨</text>
          </view>
          <view wx:elif="{{nicknameAvailable === false}}" class="unavailable">
            <text class="unavailable-text">âœ— å·²è¢«ä½¿ç”¨</text>
          </view>
        </view>
      </view>
      
      <!-- Gender Selection -->
      <view class="gender-section">
        <text class="gender-title">æ€§åˆ«</text>
        <view class="gender-selector">
          <picker 
            bindchange="onGenderChange" 
            value="{{genderIndex}}" 
            range="{{['ç”·', 'å¥³']}}"
          >
            <view class="gender-picker">
              <text class="gender-text">{{gender === 'male' ? 'ç”·' : 'å¥³'}}</text>
              <view class="picker-arrow"></view>
            </view>
          </picker>
        </view>
      </view>
      
      <view class="registration-actions">
        <button 
          bindtap="handleRegister" 
          class="register-btn" 
          type="primary"
          loading="{{isLoading}}"
        >
          å®Œæˆæ³¨å†Œ
        </button>
      </view>
    </view>
  </view>
</view>